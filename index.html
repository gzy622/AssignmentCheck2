<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>学生任务检查 Pro</title>
    <style>
        :root {
            --bg-body: #f0f2f5;
            --bg-card: #fff;
            --bg-done: #28a745;
            --text-main: #212529;
            --text-muted: #6c757d;
            --primary: #0d6efd;
            --success: #198754;
            --border: #dee2e6;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.1)
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: .5rem;
            padding: .25rem 1rem;
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            height: 52px;
            flex-shrink: 0;
            z-index: 10;
            position: relative
        }

        .progress-bar-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, .04);
            border-radius: 0 0 16px 16px;
            overflow: hidden;
            pointer-events: none
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #28a745);
            width: 0%;
            transition: width .4s cubic-bezier(.4, 0, .2, 1)
        }

        select {
            flex-grow: 1;
            padding: .5rem;
            font-size: 1rem;
            font-weight: 600;
            border: 1px solid transparent;
            border-radius: 8px;
            background-color: #f8f9fa;
            color: var(--text-main);
            outline: 0;
            transition: all .2s;
            max-width: 50%
        }

        select:hover {
            border-color: var(--border);
            background-color: #fff
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: .75rem
        }

        .counter-badge {
            font-family: 'Inter', monospace;
            font-weight: 600;
            font-size: .85rem;
            background: rgba(40, 167, 69, .1);
            color: #198754;
            padding: .35rem .75rem;
            border-radius: 99px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(40, 167, 69, .2)
        }

        button {
            padding: .4rem .8rem;
            font-size: .9rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: transparent;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all .2s;
            height: 36px
        }

        button:hover {
            background-color: #f1f3f5;
            color: var(--text-main);
            transform: translateY(-1px);
        }

        button.active {
            background-color: var(--primary);
            color: #fff !important;
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
        }

        /* Menu System */
        .menu-container {
            position: relative;
        }

        .menu-dropdown {
            position: absolute;
            top: 120%;
            right: 0;
            background: #fff;
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.2);
            padding: 0.5rem;
            display: none;
            flex-direction: column;
            gap: 0.25rem;
            z-index: 1000;
            min-width: 200px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.2s, transform 0.2s;
        }

        .menu-dropdown.open {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .menu-item {
            padding: 0.75rem 1rem;
            text-align: left;
            font-size: 0.95rem;
            font-weight: 500;
            width: 100%;
            box-sizing: border-box;
            background: none;
            border-radius: 8px;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 12px;
            height: auto;
        }

        .menu-item:hover {
            background-color: #f8f9fa;
        }

        .menu-icon {
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
            display: inline-block;
        }

        /* Main Grid */
        main {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            overflow-y: auto;
            padding: 2px;
            flex-grow: 1;
            align-content: start;
        }

        .student-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            user-select: none;
            position: relative;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
            touch-action: pan-y;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .student-card.done {
            background-color: var(--bg-done);
            border-color: #218838;
            color: #fff;
        }

        .student-card .student-id {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-muted);
            line-height: 1;
        }

        .student-card.done .student-id {
            color: rgba(255, 255, 255, 0.9);
        }

        .student-card .student-name {
            display: none;
        }

        /* View Mode: Details */
        body.mode-details .student-card .student-id {
            font-size: 0.85rem;
            margin-bottom: 2px;
        }

        body.mode-details .student-card .student-name {
            display: block;
            font-size: 0.65rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            padding: 0 2px;
            font-weight: 500;
        }

        .score-badge {
            background-color: #ffc107;
            color: #000;
            padding: 1px 4px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            position: absolute;
            top: 4px;
            right: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Dialogs */
        dialog {
            border: none;
            border-radius: 12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            padding: 0;
            max-width: 600px;
            width: 90%;
            background: var(--bg-card);
        }

        dialog::backdrop {
            background: rgba(0, 0, 0, 0.4);
        }

        .modal-header,
        .modal-footer {
            padding: 1rem;
            border-color: var(--border);
        }

        .modal-header {
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1rem;
            overflow-y: auto;
            max-height: 60vh;
        }

        .modal-footer {
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-footer button {
            width: auto;
            height: auto;
            border-radius: 6px;
            font-size: 0.95rem;
            min-width: 80px;
            padding: 0.5rem 1.25rem;
        }

        /* Statistics */
        .stat-box {
            background: #f8f9fa;
            padding: 0.75rem;
            border-radius: 6px;
            text-align: center;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        th,
        td {
            padding: 0.5rem;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }
    </style>
</head>

<body>

    <header>
        <select id="assignmentSelect" onchange="switchAsg(this.value)"></select>

        <div class="header-controls">
            <div id="counterBadge" class="counter-badge">0/49</div>
            <button id="scoringModeToggle" onclick="toggleScore()" title="打分模式">打分</button>
            <button id="viewModeToggle" onclick="toggleView()" title="切换视图">姓名</button>

            <div class="menu-container">
                <button onclick="toggleMenu()" title="更多选项">选项</button>
                <div id="menuDropdown" class="menu-dropdown">
                    <button class="menu-item" onclick="addAssignment()">
                        新建任务
                    </button>
                    <button class="menu-item" onclick="openStats()">
                        统计数据
                    </button>
                    <button class="menu-item" onclick="openRosterEditor()">
                        编辑学生名单
                    </button>
                    <div style="border-top: 1px solid var(--border); margin: 0.25rem 0;"></div>
                    <button class="menu-item" onclick="downloadBackup()">
                        导出备份
                    </button>
                    <button class="menu-item" onclick="triggerImport()">
                        导入备份
                    </button>
                    <div style="border-top: 1px solid var(--border); margin: 0.25rem 0;"></div>
                    <button class="menu-item" onclick="deleteAssignment()" style="color: #dc3545;">
                        删除当前任务
                    </button>
                </div>
            </div>
        </div>
        <div class="progress-bar-container">
            <div id="statsProgressBar" class="progress-bar-fill"></div>
        </div>
    </header>

    <main id="gridContainer">
        <!-- Grid Populated Here -->
    </main>
    <input type="file" id="importFile" style="display:none" onchange="handleImport(this)" accept=".json">

    <dialog id="statsModal">
        <div class="modal-header">
            <h3 style="margin:0">统计数据</h3>
            <button onclick="closeStats()" style="font-size:1.2rem">&times;</button>
        </div>
        <div class="modal-body">
            <div id="statsContent"></div>
        </div>
        <div class="modal-footer">
            <button onclick="closeStats()" style="padding: 0.5rem 1rem; background: #e9ecef;">关闭</button>
        </div>
    </dialog>

    <dialog id="rosterModal">
        <div class="modal-header">
            <h3 style="margin:0">编辑学生名单</h3>
            <button onclick="closeRosterEditor()" style="font-size:1.2rem">&times;</button>
        </div>
        <div class="modal-body">
            <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                每行一名学生。格式：<b>学号 姓名</b><br>
                示例：<code>01 张三</code>
            </p>
            <textarea id="rosterInput"
                style="width:100%; height:300px; padding:0.5rem; border:1px solid var(--border); border-radius:6px; font-family:monospace; box-sizing:border-box;"></textarea>
        </div>
        <div class="modal-footer">
            <button onclick="closeRosterEditor()" style="background: #e9ecef; color: var(--text-main);">取消</button>
            <button onclick="saveRoster()" style="background: var(--primary); color: white;">保存更改</button>
        </div>
    </dialog>

    <script>
        // --- Data & Configuration ---
        const DB_KEY = 'tracker_db';
        const ROSTER_KEY = 'tracker_roster';
        const DEFAULT_ROSTER = [
            "01 Alice", "02 Bob", "03 Charlie", "04 David", "05 Eve", "06 Frank", "07 Grace", "08 Heidi", "09 Ivan", "10 Judy",
            "11 Kevin", "12 Leo", "13 Mall", "14 Niaj", "15 Olivia", "16 Peggy", "17 Quentin", "18 Rupert", "19 Sybil", "20 Ted",
            "21 Ursula", "22 Victor", "23 Walter", "24 Xena", "25 Yves", "26 Zoe", "27 Aris", "28 Ber", "29 Cyd", "30 Dan",
            "31 Erin", "32 Fay", "33 Gus", "34 Hal", "35 Ida", "36 Jay", "37 Kia", "38 Lee", "39 Mia", "40 Ned",
            "41 Ola", "42 Pat", "43 Quin", "44 Ray", "45 Sue", "46 Tom", "47 Una", "48 Val", "49 Wes"
        ];

        // App State
        let ROSTER = [...DEFAULT_ROSTER];
        let assignments = [];
        let currentAssignmentId = null;
        let showNames = false;
        let isScoringMode = false;

        // Helpers
        const getStudentId = (str) => str.split(' ')[0];
        const getStudentName = (str) => str.slice(str.indexOf(' ') + 1);

        // --- Initialization ---
        function init() {
            loadData();
            if (assignments.length === 0) createAssignment("任务 1");
            else if (!currentAssignmentId) currentAssignmentId = assignments[0].id;

            renderHeader();
            renderGrid();

            // Events
            document.addEventListener('click', e => {
                if (!e.target.closest('.menu-container')) {
                    document.getElementById('menuDropdown').classList.remove('open');
                }
            });
        }

        // --- Data Management ---
        function loadData() {
            try {
                // Roster
                const storedRoster = localStorage.getItem(ROSTER_KEY);
                if (storedRoster) {
                    const parsed = JSON.parse(storedRoster);
                    if (Array.isArray(parsed) && parsed.length > 0) ROSTER = parsed;
                }
                // Assignments
                const storedDB = localStorage.getItem(DB_KEY);
                if (storedDB) assignments = JSON.parse(storedDB);
                if (!Array.isArray(assignments)) assignments = [];
            } catch (e) {
                console.error("Load error:", e);
                assignments = [];
            }
        }

        function saveData() {
            localStorage.setItem(DB_KEY, JSON.stringify(assignments));
        }

        function createAssignment(name) {
            const newAsg = {
                id: Date.now(),
                name: name,
                records: {}
            };
            // Initialize empty records
            ROSTER.forEach(s => newAsg.records[getStudentId(s)] = { done: false, score: null });
            assignments.push(newAsg);
            currentAssignmentId = newAsg.id;
            saveData();
            renderHeader();
            renderGrid();
        }

        // --- UI/View Logic ---
        function toggleView() {
            showNames = !showNames;
            document.body.classList.toggle('mode-details', showNames);
            document.getElementById('viewModeToggle').classList.toggle('active', showNames);
            renderGrid();
        }

        function toggleMenu() {
            document.getElementById('menuDropdown').classList.toggle('open');
        }

        function toggleScore() {
            isScoringMode = !isScoringMode;
            document.getElementById('scoringModeToggle').classList.toggle('active', isScoringMode);
        }

        function switchAsg(id) {
            currentAssignmentId = parseInt(id);
            renderGrid();
            updateStats();
        }

        function updateStats() {
            if (!currentAssignmentId) return;
            const cur = assignments.find(a => a.id === currentAssignmentId);
            if (!cur) return;

            let doneCount = 0;
            let total = ROSTER.length;

            ROSTER.forEach(s => {
                if (cur.records[getStudentId(s)]?.done) doneCount++;
            });

            document.getElementById('counterBadge').textContent = `${doneCount}/${total}`;

            // Update Progress Bar
            const percent = total > 0 ? (doneCount / total) * 100 : 0;
            document.getElementById('statsProgressBar').style.width = `${percent}%`;
        }

        // --- Rendering ---
        function renderHeader() {
            const sel = document.getElementById('assignmentSelect');
            sel.innerHTML = '';
            assignments.forEach(a => {
                const opt = document.createElement('option');
                opt.value = a.id;
                opt.text = a.name;
                opt.selected = a.id === currentAssignmentId;
                sel.add(opt);
            });
            updateStats();
        }

        function renderGrid() {
            const grid = document.getElementById('gridContainer');
            const cur = assignments.find(a => a.id === currentAssignmentId);
            if (!cur) return;

            // Reuse DOM if count matches
            if (grid.children.length !== ROSTER.length) grid.innerHTML = '';

            ROSTER.forEach((s, i) => {
                const id = getStudentId(s);
                const name = getStudentName(s);
                const rec = cur.records[id] || { done: false, score: null };

                let card;
                if (grid.children[i]) {
                    card = grid.children[i];
                } else {
                    card = document.createElement('div');
                    card.id = `card-${id}`;
                    setupInteraction(card, id, name);
                    card.oncontextmenu = e => { e.preventDefault(); return false; };
                    grid.appendChild(card);
                }

                // Visual Update
                card.className = `student-card ${rec.done ? 'done' : ''}`;

                let html = `<div class="student-id">${id}</div><div class="student-name">${name}</div>`;
                if (rec.score !== null) html += `<div class="score-badge">${rec.score}</div>`;

                if (card.innerHTML !== html) card.innerHTML = html;
            });
        }

        // --- Interactions ---
        function setupInteraction(card, id, name) {
            let timer, startX, startY;
            const startLongPress = () => timer = setTimeout(() => promptScore(id, name), 500);
            const clearTimer = () => { clearTimeout(timer); timer = null; };

            card.addEventListener('touchstart', e => {
                if (e.touches.length > 1) return;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                startLongPress();
            }, { passive: false });

            card.addEventListener('touchmove', e => {
                if (!timer) return;
                // Cancel if moved significantly
                if (Math.abs(e.touches[0].clientX - startX) > 10 || Math.abs(e.touches[0].clientY - startY) > 10) clearTimer();
            }, { passive: true });

            card.addEventListener('touchend', e => {
                if (timer) {
                    clearTimer();
                    // Just a click/tap
                    isScoringMode ? promptScore(id, name) : toggleDone(id);
                    if (e.cancelable) e.preventDefault();
                }
            });

            card.addEventListener('mousedown', e => { if (e.button === 0) startLongPress(); });
            card.addEventListener('mouseup', () => {
                if (timer) {
                    clearTimer();
                    isScoringMode ? promptScore(id, name) : toggleDone(id);
                }
            });
            card.addEventListener('mouseleave', clearTimer);
        }

        function toggleDone(id) {
            const cur = assignments.find(a => a.id === currentAssignmentId);
            if (!cur) return;
            if (!cur.records[id]) cur.records[id] = { done: false, score: null };

            cur.records[id].done = !cur.records[id].done;
            saveData();
            updateCardVisual(id, cur.records[id]);
            updateStats();
        }

        function updateCardVisual(id, rec) {
            const card = document.getElementById(`card-${id}`);
            if (!card) return;

            if (rec.done) card.classList.add('done');
            else card.classList.remove('done');

            let badge = card.querySelector('.score-badge');
            if (rec.score !== null) {
                if (!badge) {
                    badge = document.createElement('div');
                    badge.className = 'score-badge';
                    card.appendChild(badge);
                }
                badge.textContent = rec.score;
            } else if (badge) badge.remove();
        }

        function promptScore(id, name) {
            const cur = assignments.find(a => a.id === currentAssignmentId);
            const val = cur.records[id]?.score || '';
            const input = prompt(`请输入 ${id} ${name} 的分数:`, val);

            if (input !== null) {
                if (!cur.records[id]) cur.records[id] = { done: false, score: null };

                if (input.trim() === '') {
                    cur.records[id].score = null;
                    // Note: clearing score doesn't necessarily un-check done, but let's keep it simple
                } else {
                    const s = parseInt(input);
                    if (!isNaN(s)) {
                        cur.records[id].score = s;
                        cur.records[id].done = true;
                    }
                }
                saveData();
                updateCardVisual(id, cur.records[id]);
                updateStats();
            }
        }

        // --- Assignment Management ---
        function addAssignment() {
            toggleMenu();
            const n = prompt("任务名称:");
            if (n) createAssignment(n);
        }

        function deleteAssignment() {
            toggleMenu();
            if (!currentAssignmentId || !confirm("确定要删除此任务吗？")) return;

            assignments = assignments.filter(a => a.id != currentAssignmentId);
            if (assignments.length === 0) createAssignment("任务 1");
            else {
                currentAssignmentId = assignments[assignments.length - 1].id;
                saveData();
                renderHeader();
                renderGrid();
            }
        }

        // --- Roster Editor ---
        function openRosterEditor() {
            toggleMenu();
            document.getElementById('rosterInput').value = ROSTER.join('\n');
            document.getElementById('rosterModal').showModal();
        }

        function closeRosterEditor() {
            document.getElementById('rosterModal').close();
        }

        function saveRoster() {
            const lines = document.getElementById('rosterInput').value.split('\n')
                .map(x => x.trim()).filter(x => x.length > 0);

            if (lines.length === 0) return alert("名单不能为空！");
            if (!confirm("更新名单？学号必须保持一致以保留数据。")) return;

            ROSTER = lines;
            localStorage.setItem(ROSTER_KEY, JSON.stringify(ROSTER));
            closeRosterEditor();
            document.getElementById('gridContainer').innerHTML = ''; // Force redraw
            renderGrid();
            updateStats();
        }

        // --- Backup & Restore ---
        function downloadBackup() {
            toggleMenu();
            const data = {
                timestamp: Date.now(),
                roster: ROSTER,
                assignments: assignments
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            const now = new Date();
            const pad = n => String(n).padStart(2, '0');
            const ts = `${now.getFullYear()}${pad(now.getMonth() + 1)}${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}`;

            a.download = `tracker_backup_${ts}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function triggerImport() {
            toggleMenu();
            document.getElementById('importFile').click();
        }

        function handleImport(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (!data.assignments || !Array.isArray(data.assignments)) {
                        return alert("备份文件无效：缺少任务记录。");
                    }

                    if (confirm(`导入 ${new Date(data.timestamp || Date.now()).toLocaleString()} 的备份？这将覆盖当前数据。`)) {
                        assignments = data.assignments;
                        if (data.roster && Array.isArray(data.roster)) {
                            ROSTER = data.roster;
                            localStorage.setItem(ROSTER_KEY, JSON.stringify(ROSTER));
                        }
                        currentAssignmentId = assignments.length ? assignments[0].id : null;
                        saveData();
                        location.reload();
                    }
                } catch (err) {
                    console.error(err);
                    alert("解析备份文件出错。");
                }
                input.value = '';
            };
            reader.readAsText(file);
        }

        // --- Statistics ---
        let statsSort = 'id';
        let statsSelectedIds = [];

        function openStats() {
            toggleMenu();
            statsSelectedIds = assignments.map(a => a.id);
            renderStatsContent();
            document.getElementById('statsModal').showModal();
        }

        function closeStats() {
            document.getElementById('statsModal').close();
        }

        function renderStatsContent() {
            const container = document.getElementById('statsContent');

            // Checkboxes
            let html = '<div style="margin-bottom:1rem;display:flex;gap:10px;overflow-x:auto;">';
            assignments.forEach(a => {
                html += `<label><input type="checkbox" value="${a.id}" checked onchange="updStatSel()"> ${a.name}</label>`;
            });
            html += '</div>';

            // Calculations
            const activeAsgs = assignments.filter(a => statsSelectedIds.includes(a.id));
            const studentStats = {};
            ROSTER.forEach(s => studentStats[getStudentId(s)] = { done: 0, name: getStudentName(s) });

            let totalRecords = 0;
            let totalDone = 0;
            let scoreSum = 0;
            let scoreCount = 0;

            activeAsgs.forEach(a => {
                ROSTER.forEach(s => {
                    const id = getStudentId(s);
                    const rec = a.records[id];
                    totalRecords++;
                    if (rec && rec.done) {
                        totalDone++;
                        studentStats[id].done++;
                    }
                    if (rec && rec.score !== null) {
                        scoreSum += rec.score;
                        scoreCount++;
                    }
                });
            });

            const submitRate = totalRecords ? ((totalDone / totalRecords) * 100).toFixed(1) : 0;
            const avgScore = scoreCount ? (scoreSum / scoreCount).toFixed(1) : '-';

            html += `<div class="stats-summary">
                <div class="stat-box"><h3>${submitRate}%</h3><small>提交率</small></div>
                <div class="stat-box"><h3>${avgScore}</h3><small>平均分</small></div>
            </div>`;

            // Table
            let rows = Object.keys(studentStats).map(id => ({
                id,
                name: studentStats[id].name,
                rate: activeAsgs.length ? (studentStats[id].done / activeAsgs.length) * 100 : 0
            }));

            if (statsSort === 'rate') rows.sort((a, b) => b.rate - a.rate);
            else rows.sort((a, b) => a.id.localeCompare(b.id, undefined, { numeric: true }));

            html += `<table><thead><tr>
                <th onclick="togStatSort()">学生</th>
                <th onclick="togStatSort()">完成率</th>
            </tr></thead><tbody>`;

            rows.forEach(r => {
                html += `<tr><td><b>${r.id}</b> ${r.name}</td><td>${Math.round(r.rate)}%</td></tr>`;
            });
            html += '</tbody></table>';

            container.innerHTML = html;
        }

        function updStatSel() {
            statsSelectedIds = Array.from(document.querySelectorAll('#statsContent input:checked')).map(b => parseInt(b.value));
            renderStatsContent();
        }

        function togStatSort() {
            statsSort = statsSort === 'id' ? 'rate' : 'id';
            renderStatsContent();
        }

        // Start
        init();
    </script>
</body>

</html>